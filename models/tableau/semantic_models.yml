version: 2

semantic_models:
  - name: sales
    description: |
      Sales fact table with one row per order item.
      Contains all dimensions and measures needed for sales analysis.
    model: ref('fact_sales')

    defaults:
      agg_time_dimension: order_date

    entities:
      - name: order_item
        type: primary
        expr: order_item_id

      - name: order
        type: foreign
        expr: order_id

      - name: customer
        type: foreign
        expr: customer_id

      - name: product
        type: foreign
        expr: product_id

      - name: location
        type: foreign
        expr: location_id

    dimensions:
      - name: order_date
        type: time
        expr: order_date
        type_params:
          time_granularity: day

      - name: customer_name
        type: categorical
        expr: customer_name

      - name: customer_type
        type: categorical
        expr: customer_type

      - name: product_name
        type: categorical
        expr: product_name

      - name: product_type
        type: categorical
        expr: product_type

      - name: location_name
        type: categorical
        expr: location_name

      - name: is_food_item
        type: categorical
        expr: is_food_item

      - name: is_drink_item
        type: categorical
        expr: is_drink_item

      - name: is_food_order
        type: categorical
        expr: is_food_order

      - name: is_drink_order
        type: categorical
        expr: is_drink_order

    measures:
      - name: item_price
        description: Sum of item price
        expr: item_price
        agg: sum

      - name: item_cost
        description: Sum of item cost
        expr: item_cost
        agg: sum

      - name: item_profit
        description: Sum of item profit
        expr: item_profit
        agg: sum

      - name: item_profit_margin
        description: Average profit margin
        expr: item_profit_margin
        agg: average

      - name: order_count
        description: Distinct orders
        expr: order_id
        agg: count_distinct

      - name: order_total
        description: Average order total
        expr: order_total
        agg: average
